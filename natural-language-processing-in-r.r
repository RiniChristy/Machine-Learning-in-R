{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/rinichristy/natural-language-processing-in-r?scriptVersionId=90687984\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown","outputs":[],"execution_count":0},{"cell_type":"markdown","id":"add34f77","metadata":{"papermill":{"duration":0.048124,"end_time":"2022-03-20T13:18:37.228273","exception":false,"start_time":"2022-03-20T13:18:37.180149","status":"completed"},"tags":[]},"source":["# **Natural Language Processing of Restaurant Review**"]},{"cell_type":"markdown","id":"2e64f9c4","metadata":{"papermill":{"duration":0.042803,"end_time":"2022-03-20T13:18:37.318348","exception":false,"start_time":"2022-03-20T13:18:37.275545","status":"completed"},"tags":[]},"source":["## **Importing the dataset**"]},{"cell_type":"code","execution_count":1,"id":"79721658","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:37.408848Z","iopub.status.busy":"2022-03-20T13:18:37.407589Z","iopub.status.idle":"2022-03-20T13:18:37.541007Z","shell.execute_reply":"2022-03-20T13:18:37.538871Z"},"papermill":{"duration":0.180765,"end_time":"2022-03-20T13:18:37.541245","exception":false,"start_time":"2022-03-20T13:18:37.36048","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["                                                                                   Review\n","1                                                                Wow... Loved this place.\n","2                                                                      Crust is not good.\n","3                                               Not tasty and the texture was just nasty.\n","4 Stopped by during the late May bank holiday off Rick Steve recommendation and loved it.\n","5                             The selection on the menu was great and so were the prices.\n","6                                          Now I am getting angry and I want my damn pho.\n","  Liked\n","1     1\n","2     0\n","3     0\n","4     1\n","5     1\n","6     0\n"]}],"source":["ds_original = read.delim('../input/restaurant-reviews/Restaurant_Reviews.tsv', quote = '', stringsAsFactors = FALSE)\n","print(head(ds_original))"]},{"cell_type":"markdown","id":"63a5e504","metadata":{"papermill":{"duration":0.043806,"end_time":"2022-03-20T13:18:37.631654","exception":false,"start_time":"2022-03-20T13:18:37.587848","status":"completed"},"tags":[]},"source":["## **Cleaning the texts**"]},{"cell_type":"code","execution_count":2,"id":"94fdbd08","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:37.760196Z","iopub.status.busy":"2022-03-20T13:18:37.722712Z","iopub.status.idle":"2022-03-20T13:18:38.617641Z","shell.execute_reply":"2022-03-20T13:18:38.616442Z"},"papermill":{"duration":0.942798,"end_time":"2022-03-20T13:18:38.617814","exception":false,"start_time":"2022-03-20T13:18:37.675016","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["Loading required package: NLP\n","\n","\n","Attaching package: ‘NLP’\n","\n","\n","The following object is masked from ‘package:httr’:\n","\n","    content\n","\n","\n"]}],"source":["# install.packages('tm')\n","library(tm)\n","corpus = VCorpus(VectorSource(ds_original$Review))\n","corpus = tm_map(corpus, content_transformer(tolower))\n","corpus = tm_map(corpus, removeNumbers)\n","corpus = tm_map(corpus, removePunctuation)\n","# install.packages('SnowballC')\n","library(SnowballC)\n","corpus = tm_map(corpus, removeWords, stopwords())\n","corpus = tm_map(corpus, stemDocument)\n","corpus = tm_map(corpus, stripWhitespace)"]},{"cell_type":"markdown","id":"ece4913c","metadata":{"papermill":{"duration":0.046305,"end_time":"2022-03-20T13:18:38.710995","exception":false,"start_time":"2022-03-20T13:18:38.66469","status":"completed"},"tags":[]},"source":["## **Creating the Bag of Words model**"]},{"cell_type":"code","execution_count":3,"id":"4f5eefc3","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:38.810033Z","iopub.status.busy":"2022-03-20T13:18:38.808599Z","iopub.status.idle":"2022-03-20T13:18:39.026391Z","shell.execute_reply":"2022-03-20T13:18:39.024948Z"},"papermill":{"duration":0.268679,"end_time":"2022-03-20T13:18:39.026544","exception":false,"start_time":"2022-03-20T13:18:38.757865","status":"completed"},"tags":[]},"outputs":[],"source":["dtm = DocumentTermMatrix(corpus)\n","dtm = removeSparseTerms(dtm, 0.999)\n","ds = as.data.frame(as.matrix(dtm))\n","ds$Liked = ds_original$Liked"]},{"cell_type":"markdown","id":"22b2162f","metadata":{"papermill":{"duration":0.046035,"end_time":"2022-03-20T13:18:39.120123","exception":false,"start_time":"2022-03-20T13:18:39.074088","status":"completed"},"tags":[]},"source":["## **Encoding the target feature as factor**"]},{"cell_type":"code","execution_count":4,"id":"80d994dd","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:39.218308Z","iopub.status.busy":"2022-03-20T13:18:39.217098Z","iopub.status.idle":"2022-03-20T13:18:39.23099Z","shell.execute_reply":"2022-03-20T13:18:39.229235Z"},"papermill":{"duration":0.065402,"end_time":"2022-03-20T13:18:39.231138","exception":false,"start_time":"2022-03-20T13:18:39.165736","status":"completed"},"tags":[]},"outputs":[],"source":["ds$Liked = factor(ds$Liked, levels = c(0, 1))"]},{"cell_type":"markdown","id":"96266e6e","metadata":{"papermill":{"duration":0.047464,"end_time":"2022-03-20T13:18:39.325404","exception":false,"start_time":"2022-03-20T13:18:39.27794","status":"completed"},"tags":[]},"source":["## **Splitting the dataset into the Training set and Test set**"]},{"cell_type":"code","execution_count":5,"id":"89cd6966","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:39.426006Z","iopub.status.busy":"2022-03-20T13:18:39.425067Z","iopub.status.idle":"2022-03-20T13:18:39.504411Z","shell.execute_reply":"2022-03-20T13:18:39.502521Z"},"papermill":{"duration":0.131796,"end_time":"2022-03-20T13:18:39.504582","exception":false,"start_time":"2022-03-20T13:18:39.372786","status":"completed"},"tags":[]},"outputs":[],"source":["# install.packages('caTools')\n","library(caTools)\n","set.seed(123)\n","split = sample.split(ds$Liked, SplitRatio = 0.8)\n","train_set = subset(ds, split == TRUE)\n","test_set = subset(ds, split == FALSE)"]},{"cell_type":"markdown","id":"dc22c95e","metadata":{"papermill":{"duration":0.059332,"end_time":"2022-03-20T13:18:39.62321","exception":false,"start_time":"2022-03-20T13:18:39.563878","status":"completed"},"tags":[]},"source":["## **Fitting Random Forest Classification to the Training set**"]},{"cell_type":"code","execution_count":6,"id":"65e7f83c","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:39.74949Z","iopub.status.busy":"2022-03-20T13:18:39.746917Z","iopub.status.idle":"2022-03-20T13:18:40.760107Z","shell.execute_reply":"2022-03-20T13:18:40.758533Z"},"papermill":{"duration":1.077658,"end_time":"2022-03-20T13:18:40.760238","exception":false,"start_time":"2022-03-20T13:18:39.68258","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["randomForest 4.6-14\n","\n","Type rfNews() to see new features/changes/bug fixes.\n","\n"]},{"name":"stdout","output_type":"stream","text":["   y_pred\n","     0  1\n","  0 82 18\n","  1 23 77\n"]}],"source":["# install.packages('randomForest')\n","library(randomForest)\n","classifier = randomForest(x = train_set[-692],\n","                          y = train_set$Liked,\n","                          ntree = 10)\n","# Predicting the Test set results\n","y_pred = predict(classifier, newdata = test_set[-692])\n","\n","# Making the Confusion Matrix\n","cm = table(test_set[, 692], y_pred)\n","print(cm)"]},{"cell_type":"markdown","id":"01c4967c","metadata":{"papermill":{"duration":0.050246,"end_time":"2022-03-20T13:18:40.861564","exception":false,"start_time":"2022-03-20T13:18:40.811318","status":"completed"},"tags":[]},"source":["## **Evaluation Metrics**"]},{"cell_type":"code","execution_count":7,"id":"f0ccc376","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:40.969372Z","iopub.status.busy":"2022-03-20T13:18:40.967489Z","iopub.status.idle":"2022-03-20T13:18:41.028697Z","shell.execute_reply":"2022-03-20T13:18:41.028063Z"},"papermill":{"duration":0.11583,"end_time":"2022-03-20T13:18:41.02885","exception":false,"start_time":"2022-03-20T13:18:40.91302","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Accuracy of NLP Random Forest Model is: 0.795"]},{"data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 2 × 3</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>precision</th><th scope=col>recall</th><th scope=col>f1</th></tr>\n","\t<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>0</th><td>0.7809524</td><td>0.82</td><td>0.8000000</td></tr>\n","\t<tr><th scope=row>1</th><td>0.8105263</td><td>0.77</td><td>0.7897436</td></tr>\n","</tbody>\n","</table>\n"],"text/latex":["A data.frame: 2 × 3\n","\\begin{tabular}{r|lll}\n","  & precision & recall & f1\\\\\n","  & <dbl> & <dbl> & <dbl>\\\\\n","\\hline\n","\t0 & 0.7809524 & 0.82 & 0.8000000\\\\\n","\t1 & 0.8105263 & 0.77 & 0.7897436\\\\\n","\\end{tabular}\n"],"text/markdown":["\n","A data.frame: 2 × 3\n","\n","| <!--/--> | precision &lt;dbl&gt; | recall &lt;dbl&gt; | f1 &lt;dbl&gt; |\n","|---|---|---|---|\n","| 0 | 0.7809524 | 0.82 | 0.8000000 |\n","| 1 | 0.8105263 | 0.77 | 0.7897436 |\n","\n"],"text/plain":["  precision recall f1       \n","0 0.7809524 0.82   0.8000000\n","1 0.8105263 0.77   0.7897436"]},"metadata":{},"output_type":"display_data"}],"source":["n = sum(cm) # number of instances\n","nc = nrow(cm) # number of classes\n","diag = diag(cm) # number of correctly classified instances per class \n","rowsums = apply(cm, 1, sum) # number of instances per class\n","colsums = apply(cm, 2, sum) # number of predictions per class\n","p = rowsums / n # distribution of instances over the actual classes\n","q = colsums / n # distribution of instances over the predicted classes\n","accuracy = sum(diag) / n \n","cat(\"Accuracy of NLP Random Forest Model is:\", accuracy)  \n","precision = diag / colsums \n","recall = diag / rowsums \n","f1 = 2 * precision * recall / (precision + recall) \n","data.frame(precision, recall, f1) "]},{"cell_type":"code","execution_count":8,"id":"36a0b776","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:41.141322Z","iopub.status.busy":"2022-03-20T13:18:41.139866Z","iopub.status.idle":"2022-03-20T13:18:41.905347Z","shell.execute_reply":"2022-03-20T13:18:41.904047Z"},"papermill":{"duration":0.823435,"end_time":"2022-03-20T13:18:41.905481","exception":false,"start_time":"2022-03-20T13:18:41.082046","status":"completed"},"tags":[]},"outputs":[{"name":"stderr","output_type":"stream","text":["Warning message in svm.default(x, y, scale = scale, ..., na.action = na.action):\n","“Variable(s) ‘boot’ and ‘brick’ and ‘eye’ and ‘given’ and ‘legit’ and ‘mall’ and ‘oven’ and ‘peanut’ and ‘pure’ and ‘scallop’ and ‘show’ and ‘tap’ constant. Cannot scale data.”\n"]},{"name":"stdout","output_type":"stream","text":["   y_pred\n","      0   1\n","  0 100   0\n","  1  94   6\n","Accuracy of NLP SVM is: 0.53"]},{"data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 2 × 3</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>precision</th><th scope=col>recall</th><th scope=col>f1</th></tr>\n","\t<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>0</th><td>0.5154639</td><td>1.00</td><td>0.6802721</td></tr>\n","\t<tr><th scope=row>1</th><td>1.0000000</td><td>0.06</td><td>0.1132075</td></tr>\n","</tbody>\n","</table>\n"],"text/latex":["A data.frame: 2 × 3\n","\\begin{tabular}{r|lll}\n","  & precision & recall & f1\\\\\n","  & <dbl> & <dbl> & <dbl>\\\\\n","\\hline\n","\t0 & 0.5154639 & 1.00 & 0.6802721\\\\\n","\t1 & 1.0000000 & 0.06 & 0.1132075\\\\\n","\\end{tabular}\n"],"text/markdown":["\n","A data.frame: 2 × 3\n","\n","| <!--/--> | precision &lt;dbl&gt; | recall &lt;dbl&gt; | f1 &lt;dbl&gt; |\n","|---|---|---|---|\n","| 0 | 0.5154639 | 1.00 | 0.6802721 |\n","| 1 | 1.0000000 | 0.06 | 0.1132075 |\n","\n"],"text/plain":["  precision recall f1       \n","0 0.5154639 1.00   0.6802721\n","1 1.0000000 0.06   0.1132075"]},"metadata":{},"output_type":"display_data"}],"source":["# Support Vector Classifier\n","library(e1071)\n","classifier = svm(formula = Liked ~ .,\n","                 data = train_set,\n","                 type = 'C-classification',\n","                 kernel = 'radial')\n","\n","\n","# Predicting the Test set results\n","y_pred = predict(classifier, newdata = test_set[-692])\n","\n","# Making the Confusion Matrix\n","cm = table(test_set[, 692], y_pred)\n","print(cm)\n","n = sum(cm) # number of instances\n","nc = nrow(cm) # number of classes\n","diag = diag(cm) # number of correctly classified instances per class \n","rowsums = apply(cm, 1, sum) # number of instances per class\n","colsums = apply(cm, 2, sum) # number of predictions per class\n","p = rowsums / n # distribution of instances over the actual classes\n","q = colsums / n # distribution of instances over the predicted classes\n","accuracy = sum(diag) / n \n","cat(\"Accuracy of NLP SVM is:\", accuracy)  \n","precision = diag / colsums \n","recall = diag / rowsums \n","f1 = 2 * precision * recall / (precision + recall) \n","data.frame(precision, recall, f1) "]},{"cell_type":"code","execution_count":9,"id":"16d4ae22","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:42.032445Z","iopub.status.busy":"2022-03-20T13:18:42.030844Z","iopub.status.idle":"2022-03-20T13:18:44.386331Z","shell.execute_reply":"2022-03-20T13:18:44.384897Z"},"papermill":{"duration":2.420317,"end_time":"2022-03-20T13:18:44.386465","exception":false,"start_time":"2022-03-20T13:18:41.966148","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["   y_pred\n","     0  1\n","  0  5 95\n","  1  4 96\n","Accuracy of NLP SVM is: 0.505"]},{"data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 2 × 3</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>precision</th><th scope=col>recall</th><th scope=col>f1</th></tr>\n","\t<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>0</th><td>0.5555556</td><td>0.05</td><td>0.09174312</td></tr>\n","\t<tr><th scope=row>1</th><td>0.5026178</td><td>0.96</td><td>0.65979381</td></tr>\n","</tbody>\n","</table>\n"],"text/latex":["A data.frame: 2 × 3\n","\\begin{tabular}{r|lll}\n","  & precision & recall & f1\\\\\n","  & <dbl> & <dbl> & <dbl>\\\\\n","\\hline\n","\t0 & 0.5555556 & 0.05 & 0.09174312\\\\\n","\t1 & 0.5026178 & 0.96 & 0.65979381\\\\\n","\\end{tabular}\n"],"text/markdown":["\n","A data.frame: 2 × 3\n","\n","| <!--/--> | precision &lt;dbl&gt; | recall &lt;dbl&gt; | f1 &lt;dbl&gt; |\n","|---|---|---|---|\n","| 0 | 0.5555556 | 0.05 | 0.09174312 |\n","| 1 | 0.5026178 | 0.96 | 0.65979381 |\n","\n"],"text/plain":["  precision recall f1        \n","0 0.5555556 0.05   0.09174312\n","1 0.5026178 0.96   0.65979381"]},"metadata":{},"output_type":"display_data"}],"source":["# Naive Bayes Classifier\n","library(e1071)\n","classifier = naiveBayes(x = train_set[-692], y = train_set$Liked)\n","\n","# Predicting the Test set results\n","y_pred = predict(classifier, newdata = test_set[-692])\n","\n","# Making the Confusion Matrix\n","cm = table(test_set[, 692], y_pred)\n","print(cm)\n","n = sum(cm) # number of instances\n","nc = nrow(cm) # number of classes\n","diag = diag(cm) # number of correctly classified instances per class \n","rowsums = apply(cm, 1, sum) # number of instances per class\n","colsums = apply(cm, 2, sum) # number of predictions per class\n","p = rowsums / n # distribution of instances over the actual classes\n","q = colsums / n # distribution of instances over the predicted classes\n","accuracy = sum(diag) / n \n","cat(\"Accuracy of NLP SVM is:\", accuracy)  \n","precision = diag / colsums \n","recall = diag / rowsums \n","f1 = 2 * precision * recall / (precision + recall) \n","data.frame(precision, recall, f1)\n"]},{"cell_type":"code","execution_count":10,"id":"22cee957","metadata":{"execution":{"iopub.execute_input":"2022-03-20T13:18:44.52088Z","iopub.status.busy":"2022-03-20T13:18:44.519399Z","iopub.status.idle":"2022-03-20T13:18:46.71856Z","shell.execute_reply":"2022-03-20T13:18:46.717149Z"},"papermill":{"duration":2.267686,"end_time":"2022-03-20T13:18:46.718709","exception":false,"start_time":"2022-03-20T13:18:44.451023","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["   y_pred\n","     0  1\n","  0 85 15\n","  1 43 57\n","Accuracy of NLP Decision Tree is: 0.71"]},{"data":{"text/html":["<table class=\"dataframe\">\n","<caption>A data.frame: 2 × 3</caption>\n","<thead>\n","\t<tr><th></th><th scope=col>precision</th><th scope=col>recall</th><th scope=col>f1</th></tr>\n","\t<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>\n","</thead>\n","<tbody>\n","\t<tr><th scope=row>0</th><td>0.6640625</td><td>0.85</td><td>0.7456140</td></tr>\n","\t<tr><th scope=row>1</th><td>0.7916667</td><td>0.57</td><td>0.6627907</td></tr>\n","</tbody>\n","</table>\n"],"text/latex":["A data.frame: 2 × 3\n","\\begin{tabular}{r|lll}\n","  & precision & recall & f1\\\\\n","  & <dbl> & <dbl> & <dbl>\\\\\n","\\hline\n","\t0 & 0.6640625 & 0.85 & 0.7456140\\\\\n","\t1 & 0.7916667 & 0.57 & 0.6627907\\\\\n","\\end{tabular}\n"],"text/markdown":["\n","A data.frame: 2 × 3\n","\n","| <!--/--> | precision &lt;dbl&gt; | recall &lt;dbl&gt; | f1 &lt;dbl&gt; |\n","|---|---|---|---|\n","| 0 | 0.6640625 | 0.85 | 0.7456140 |\n","| 1 | 0.7916667 | 0.57 | 0.6627907 |\n","\n"],"text/plain":["  precision recall f1       \n","0 0.6640625 0.85   0.7456140\n","1 0.7916667 0.57   0.6627907"]},"metadata":{},"output_type":"display_data"}],"source":["# Decision Tree Classifier\n","library(rpart)\n","classifier = rpart(formula = Liked ~ ., data = train_set)\n","# Predicting the Test set results\n","y_pred = predict(classifier, newdata = test_set[-692], type = 'class')\n","# Making the Confusion Matrix\n","cm = table(test_set[, 692], y_pred)\n","print(cm)\n","n = sum(cm) # number of instances\n","nc = nrow(cm) # number of classes\n","diag = diag(cm) # number of correctly classified instances per class \n","rowsums = apply(cm, 1, sum) # number of instances per class\n","colsums = apply(cm, 2, sum) # number of predictions per class\n","p = rowsums / n # distribution of instances over the actual classes\n","q = colsums / n # distribution of instances over the predicted classes\n","accuracy = sum(diag) / n \n","cat(\"Accuracy of NLP Decision Tree is:\", accuracy)  \n","precision = diag / colsums \n","recall = diag / rowsums \n","f1 = 2 * precision * recall / (precision + recall) \n","data.frame(precision, recall, f1)\n"]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"codemirror_mode":"r","file_extension":".r","mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"4.0.5"},"papermill":{"default_parameters":{},"duration":12.682361,"end_time":"2022-03-20T13:18:46.899417","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2022-03-20T13:18:34.217056","version":"2.3.3"}},"nbformat":4,"nbformat_minor":5}